function doPost(e) {
  try {
    // Parse incoming body: coba JSON dulu, kalau gagal fallback ke e.parameter
    var payload = {};
    if (e.postData && e.postData.contents) {
      try {
        payload = JSON.parse(e.postData.contents);
      } catch (jsonErr) {
        // jika bukan JSON, tetap coba gunakan e.parameter
        payload = e.parameter || {};
      }
    } else {
      payload = e.parameter || {};
    }

    // Buka spreadsheet dan sheet (ganti ID dan nama sheet)
    var ss = SpreadsheetApp.openById("10tX29vkIA9xij1MsLmYk5PBR-GuRADHApLg9yUpRw8w"); // <-- ganti dengan ID sheet
    var sheet = ss.getSheetByName("Sheet1"); // <-- ganti dengan nama sheet ('Sheet1'/'Data' dll)

    // Siapkan nilai default / trimming
    var tipe = (payload.type || payload.tipe || "").toString().trim();
    var tujuan = (payload.to || payload.divisi || payload.tujuan || "").toString().trim();
    var isi = (payload.content || payload.ide || payload.isi || "").toString().trim();
    var nama = (payload.nama || payload.name || "").toString().trim();

    var timestamp = new Date();

    // Susun row sesuai kolom: Timestamp, Type, Tujuan/Divisi, isi Pesan/Ide, Nama Pegawai
    var row = [ timestamp, tipe, tujuan, isi, nama ];

    sheet.appendRow(row);

    // Kembalikan respons JSON (normal web app response)
    return ContentService
      .createTextOutput(JSON.stringify({ result: "success" }))
      .setMimeType(ContentService.MimeType.JSON);

  } catch (err) {
    // Log error untuk debugging
    Logger.log("doPost error: " + err);
    return ContentService
      .createTextOutput(JSON.stringify({ result: "error", message: err.toString() }))
      .setMimeType(ContentService.MimeType.JSON);
  }
}
